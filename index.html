<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marcador.</title>
<style>
  :root{
    --bg:#0b0d12;
    --panel:#111826;
    --accent:#22c55e;
    --danger:#ef4444;
    --text:#e6eefc;
    --muted:#9db2d8;
    --radius:10px;
  }
  body{
    background:var(--bg);
    color:var(--text);
    font-family:system-ui, sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
  }
  h1{color:var(--accent);text-align:center;}
  form{
    background:var(--panel);
    padding:20px;
    border-radius:var(--radius);
    box-shadow:0 4px 15px rgba(0,0,0,.3);
    max-width:400px;
    width:100%;
    margin-bottom:20px;
  }
  input,button,select{
    width:100%;
    padding:10px;
    margin:5px 0;
    border-radius:var(--radius);
    border:none;
    font-size:1rem;
  }
  button{
    background:var(--accent);
    color:white;
    cursor:pointer;
  }
  button:hover{opacity:.8;}
  .jugadores, .partidas{
    background:var(--panel);
    padding:15px;
    border-radius:var(--radius);
    margin-top:15px;
    width:100%;
    max-width:600px;
  }
  .jugador{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin:10px 0;
    flex-wrap:wrap;
  }
  .nombre{
    font-weight:bold;
  }
  .perdidas{
    color:var(--muted);
    font-size:1.2rem; /* tama√±o ajustable del texto */
  }
  .perdidas span{
    font-size:1.4rem;
    font-weight:bold;
    color:var(--accent);
  }
  .cuadrados{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:10px;
  }
  .cuadro{
    width:28px;
    height:28px;
    border:2px solid var(--muted);
    border-radius:5px;
    cursor:pointer;
    transition:background .2s;
  }
  .cuadro.verde{background:var(--accent);}
  .cuadro.rojo{background:var(--danger);}
</style>
</head>
<body>
  <h1>Marcador de Derrotas</h1>

  <form id="formConfig">
    <label>N√∫mero de jugadores (2‚Äì6):</label>
    <input type="number" id="numJugadores" min="2" max="6" required>

    <div id="nombresContainer"></div>

    <label>N√∫mero de rondas:</label>
    <input type="number" id="numRondas" min="1" required>

    <button type="submit">Iniciar Partida</button>
  </form>

  <div id="marcador"></div>

<script>
const form = document.getElementById('formConfig');
const nombresContainer = document.getElementById('nombresContainer');
const marcadorDiv = document.getElementById('marcador');
let jugadores = [];

// üéµ Funci√≥n para reproducir una melod√≠a de 12 notas repetida 3 veces
function reproducirMelodia() {
  const ctx = new (window.AudioContext || window.webkitAudioContext)();

  // Escala alegre (C mayor con 12 notas, incluye octava superior)
  const notas = [
    261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88,
    523.25, 587.33, 659.25, 698.46, 783.99
  ];
  const duracion = 0.05; // duraci√≥n por nota en segundos
  const repeticiones = 3;

  for (let r = 0; r < repeticiones; r++) {
    notas.forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.frequency.value = freq;
      osc.type = "triangle";
      const inicio = ctx.currentTime + (r * notas.length + i) * duracion;
      const fin = inicio + duracion;
      gain.gain.setValueAtTime(0.15, inicio);
      gain.gain.exponentialRampToValueAtTime(0.001, fin);
      osc.start(inicio);
      osc.stop(fin);
    });
  }
}

document.getElementById('numJugadores').addEventListener('input', e=>{
  const n = parseInt(e.target.value)||0;
  nombresContainer.innerHTML='';
  for(let i=0;i<n;i++){
    const input = document.createElement('input');
    input.placeholder = 'Nombre del jugador '+(i+1);
    input.required = true;
    nombresContainer.appendChild(input);
  }
});

form.addEventListener('submit', e=>{
  e.preventDefault();
  const n = parseInt(document.getElementById('numJugadores').value);
  const rondas = parseInt(document.getElementById('numRondas').value);
  const nombres = [...nombresContainer.querySelectorAll('input')].map(i=>i.value.trim());
  if(nombres.length!==n || nombres.some(x=>!x)) return alert('Introduce todos los nombres');
  iniciarPartida(nombres,rondas);
});

function iniciarPartida(nombres,rondas){
  form.style.display='none';
  jugadores = nombres.map(n=>({nombre:n,perdidas:0,finalizado:false}));
  renderMarcador(rondas);
}

function renderMarcador(rondas){
  marcadorDiv.innerHTML='';
  jugadores.forEach((jugador,idx)=>{
    const div = document.createElement('div');
    div.className='jugador';
    div.innerHTML=`<span class="nombre">${jugador.nombre}</span>
                   <span class="perdidas">  : <span id="p-${idx}">0</span></span>`;
    const cuadros = document.createElement('div');
    cuadros.className='cuadrados';
    for(let i=0;i<rondas;i++){
      const c = document.createElement('div');
      c.className='cuadro';
      c.addEventListener('click',()=>alternarCuadro(idx,c,rondas));
      cuadros.appendChild(c);
    }
    div.appendChild(cuadros);
    marcadorDiv.appendChild(div);
  });
}

function alternarCuadro(idx,cuadro,maxRondas){
  const jugador = jugadores[idx];
  const cont = cuadro.parentElement;
  const cuadros = cont.querySelectorAll('.cuadro');
  const todosRojos = [...cuadros].every(c=>c.classList.contains('rojo'));

  // Caso de rectificaci√≥n tras finalizar (todo rojo)
  if(todosRojos){
    jugador.perdidas = Math.max(0, jugador.perdidas - 1);
    cuadros.forEach(c=>c.classList.remove('rojo','verde'));
    for(let i=0;i<jugador.perdidas;i++) cuadros[i].classList.add('verde');
    jugador.finalizado = false;
    document.getElementById(`p-${idx}`).textContent = jugador.perdidas;
    return;
  }

  // Conmutaci√≥n normal
  if(cuadro.classList.contains('verde')){
    cuadro.classList.remove('verde');
    jugador.perdidas = Math.max(0, jugador.perdidas - 1);
  } else if(!cuadro.classList.contains('rojo')){
    cuadro.classList.add('verde');
    jugador.perdidas++;
  }

  document.getElementById(`p-${idx}`).textContent = jugador.perdidas;

  // Si alcanza el l√≠mite, pasar a ROJO (finalizado)
  if(jugador.perdidas >= maxRondas){
    cuadros.forEach(c=>{ c.classList.remove('verde'); c.classList.add('rojo'); });
    if(!jugador.finalizado){
      jugador.finalizado = true;
      reproducirMelodia(); // üé∂ Suena la melod√≠a (12 notas √ó 3 ciclos)
    }
  } else {
    cuadros.forEach(c=>c.classList.remove('rojo'));
    jugador.finalizado = false;
  }
}
</script>
</body>
</html>
